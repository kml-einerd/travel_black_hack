<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Community Wins - MilesAI</title>
  <link rel="stylesheet" href="../css/design-system.css">
  <link rel="stylesheet" href="../css/components.css">
  <style>
  <script src="https://unpkg.com/lucide@latest"></script>
    body { padding: var(--space-8); background: var(--color-bg-canvas); }
    .page-header { text-align: center; margin-bottom: var(--space-8); }
    .page-header__subtitle {
      color: var(--color-text-secondary);
      font-size: var(--text-lg);
      margin-top: var(--space-2);
    }

    .wins-feed { max-width: 900px; margin: 0 auto; }

    .win-card {
      background: white;
      border-radius: var(--radius-2xl);
      margin-bottom: var(--space-8);
      overflow: hidden;
      box-shadow: var(--shadow-card);
      transition: all var(--transition-normal);
    }

    .win-card:hover { box-shadow: var(--shadow-card-hover); }

    .win-card__user {
      padding: var(--space-5);
      display: flex;
      align-items: center;
      gap: var(--space-3);
      border-bottom: 1px solid var(--color-divider);
    }

    .win-card__avatar {
      font-size: var(--text-3xl);
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-bg-secondary);
      border-radius: var(--radius-full);
    }

    .win-card__user-info { flex: 1; }

    .win-card__username {
      font-weight: var(--font-semibold);
      color: var(--color-text-primary);
      font-size: var(--text-base);
    }

    .win-card__user-meta {
      font-size: var(--text-xs);
      color: var(--color-text-muted);
      margin-top: var(--space-1);
    }

    .win-card__type-badge {
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: var(--font-semibold);
      text-transform: uppercase;
    }

    .win-card__type-badge--epic_redemption {
      background: var(--color-primary-light);
      color: var(--color-primary-dark);
    }

    .win-card__type-badge--budget_win {
      background: var(--color-success-light);
      color: var(--color-success-dark);
    }

    .win-card__type-badge--hack_discovery {
      background: var(--color-accent-light);
      color: var(--color-accent-dark);
    }

    .win-card__image {
      width: 100%;
      height: 400px;
      object-fit: cover;
    }

    .win-card__content { padding: var(--space-6); }

    .win-card__title {
      font-size: var(--text-2xl);
      font-weight: var(--font-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-4);
    }

    .win-card__route {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      background: var(--color-bg-secondary);
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-full);
      font-size: var(--text-sm);
      font-weight: var(--font-medium);
      margin-bottom: var(--space-4);
    }

    .win-card__redemption-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--space-4);
      background: var(--color-primary-light);
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      margin-bottom: var(--space-5);
    }

    .redemption-stat {
      display: flex;
      flex-direction: column;
    }

    .redemption-stat__label {
      font-size: var(--text-xs);
      color: var(--color-text-muted);
      text-transform: uppercase;
      margin-bottom: var(--space-1);
    }

    .redemption-stat__value {
      font-size: var(--text-lg);
      font-weight: var(--font-bold);
      color: var(--color-primary);
    }

    .redemption-stat__value--highlight {
      font-size: var(--text-2xl);
      color: var(--color-success);
    }

    .win-card__story {
      font-size: var(--text-base);
      line-height: var(--leading-relaxed);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-5);
      padding: var(--space-4);
      background: var(--color-bg-secondary);
      border-radius: var(--radius-lg);
      border-left: 4px solid var(--color-primary);
    }

    .win-card__summary {
      font-size: var(--text-lg);
      line-height: var(--leading-relaxed);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
    }

    .win-card__details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      background: var(--color-bg-secondary);
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      margin-bottom: var(--space-5);
    }

    .detail-item {
      display: flex;
      flex-direction: column;
    }

    .detail-item__label {
      font-size: var(--text-xs);
      color: var(--color-text-muted);
      margin-bottom: var(--space-1);
    }

    .detail-item__value {
      font-size: var(--text-base);
      font-weight: var(--font-semibold);
      color: var(--color-text-primary);
    }

    .detail-item__value--success {
      color: var(--color-success);
      font-size: var(--text-xl);
    }

    .win-card__hack {
      background: var(--color-accent-light);
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      margin-bottom: var(--space-4);
      border: 2px solid var(--color-accent);
    }

    .win-card__hack-content {
      font-size: var(--text-base);
      line-height: var(--leading-relaxed);
      color: var(--color-text-primary);
      margin-bottom: var(--space-3);
      font-weight: var(--font-medium);
    }

    .win-card__warning {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3);
      background: var(--color-warning-light);
      border-radius: var(--radius-lg);
      font-size: var(--text-sm);
      color: var(--color-warning-dark);
      font-weight: var(--font-medium);
    }

    .win-card__tips {
      background: var(--color-bg-secondary);
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-5);
    }

    .win-card__tips-title {
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-3);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .tips-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .tips-list__item {
      padding: var(--space-2) 0;
      color: var(--color-text-secondary);
      font-size: var(--text-sm);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .tips-list__item::before {
      content: '';
      font-size: var(--text-base);
    }

    .win-card__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: var(--space-4);
      border-top: 1px solid var(--color-divider);
    }

    .engagement {
      display: flex;
      gap: var(--space-6);
      font-size: var(--text-sm);
    }

    .engagement__item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--color-text-muted);
      cursor: pointer;
      transition: color var(--transition-fast);
    }

    .engagement__item:hover {
      color: var(--color-primary);
    }

    .engagement__count {
      font-weight: var(--font-medium);
    }

    @media (max-width: 768px) {
      .win-card__image { height: 250px; }
      .win-card__redemption-grid { grid-template-columns: repeat(2, 1fr); }
      .win-card__details-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>
        <i data-lucide="trophy" class="icon icon--lg"></i>
        <span>Community Wins</span>
      </h1>
      <p class="page-header__subtitle">
        Real redemptions, real savings, real people crushing the travel hacking game
      </p>
    </header>

    <div class="wins-feed" id="wins-feed">
      <!-- Stories loaded dynamically -->
    </div>
  </div>

  <script>
    async function loadWins() {
      try {
        const response = await fetch('../data/community-wins.json');
        const data = await response.json();
        renderWins(data.stories);
      } catch (error) {
        console.error('Error loading wins:', error);
      }
    }

    function renderWins(stories) {
      const feed = document.getElementById('wins-feed');

      feed.innerHTML = stories.map(story => {
        if (story.type === 'epic_redemption') {
          return renderEpicRedemption(story);
        } else if (story.type === 'budget_win') {
          return renderBudgetWin(story);
        } else if (story.type === 'hack_discovery') {
          return renderHackDiscovery(story);
        }
      }).join('');
      lucide.createIcons();
    }

    function renderEpicRedemption(story) {
      return `
        <article class="win-card">
          <div class="win-card__user">
            <div class="win-card__avatar">${story.user.avatar}</div>
            <div class="win-card__user-info">
              <div class="win-card__username">${story.user.username}</div>
              <div class="win-card__user-meta">
                Member since ${formatMemberSince(story.user.member_since)} •
                $${formatNumber(story.user.total_value_redeemed)} total value redeemed
              </div>
            </div>
            <div class="win-card__type-badge win-card__type-badge--epic_redemption">
              Epic Redemption
            </div>
          </div>

          <img src="${story.image}" alt="${story.title}" class="win-card__image">

          <div class="win-card__content">
            <h2 class="win-card__title">${story.title}</h2>

            ${story.route ? `
              <div class="win-card__route">
                <i data-lucide="plane" class="icon icon--xs"></i> ${story.route.origin} → ${story.route.destination}</span>
              </div>
            ` : ''}

            <div class="win-card__redemption-grid">
              <div class="redemption-stat">
                <span class="redemption-stat__label">Airline</span>
                <span class="redemption-stat__value">${story.redemption.airline}</span>
              </div>
              <div class="redemption-stat">
                <span class="redemption-stat__label">Cabin</span>
                <span class="redemption-stat__value">${story.redemption.cabin}</span>
              </div>
              <div class="redemption-stat">
                <span class="redemption-stat__label">Program Used</span>
                <span class="redemption-stat__value">${story.redemption.program_used}</span>
              </div>
              <div class="redemption-stat">
                <span class="redemption-stat__label">Points Used</span>
                <span class="redemption-stat__value">${formatNumber(story.redemption.points_used)}</span>
              </div>
              <div class="redemption-stat">
                <span class="redemption-stat__label">Taxes Paid</span>
                <span class="redemption-stat__value">$${story.redemption.taxes_paid}</span>
              </div>
              <div class="redemption-stat">
                <span class="redemption-stat__label">Cash Value</span>
                <span class="redemption-stat__value--highlight">$${formatNumber(story.redemption.cash_value)}</span>
              </div>
              <div class="redemption-stat">
                <span class="redemption-stat__label">CPP</span>
                <span class="redemption-stat__value--highlight">${story.redemption.cpp}¢</span>
              </div>
            </div>

            <div class="win-card__story">
              "${story.story}"
            </div>

            ${story.tips && story.tips.length > 0 ? `
              <div class="win-card__tips">
                <div class="win-card__tips-title">Pro Tips</div>
                <ul class="tips-list">
                  ${story.tips.map(tip => `
                    <li class="tips-list__item">${tip}</li>
                  `).join('')}
                </ul>
              </div>
            ` : ''}

            <div class="win-card__footer">
              <div class="engagement">
                <div class="engagement__item">
                  <i data-lucide="heart" class="icon icon--xs"></i>
                  <span class="engagement__count">${formatNumber(story.engagement.likes)}</span>
                </div>
                <div class="engagement__item">
                  <i data-lucide="message-circle" class="icon icon--xs"></i>
                  <span class="engagement__count">${formatNumber(story.engagement.comments)}</span>
                </div>
                ${story.engagement.saves ? `
                  <div class="engagement__item">
                    <i data-lucide="bookmark" class="icon icon--xs"></i>
                    <span class="engagement__count">${formatNumber(story.engagement.saves)}</span>
                  </div>
                ` : ''}
              </div>
              <span style="font-size: var(--text-xs); color: var(--color-text-muted);">
                ${formatTime(story.posted_at)}
              </span>
            </div>
          </div>
        </article>
      `;
    }

    function renderBudgetWin(story) {
      return `
        <article class="win-card">
          <div class="win-card__user">
            <div class="win-card__avatar">${story.user.avatar}</div>
            <div class="win-card__user-info">
              <div class="win-card__username">${story.user.username}</div>
            </div>
            <div class="win-card__type-badge win-card__type-badge--budget_win">
              Budget Win
            </div>
          </div>

          <img src="${story.image}" alt="${story.title}" class="win-card__image">

          <div class="win-card__content">
            <h2 class="win-card__title">${story.title}</h2>
            <p class="win-card__summary">${story.summary}</p>

            <div class="win-card__details-grid">
              <div class="detail-item">
                <span class="detail-item__label">People</span>
                <span class="detail-item__value">${story.details.people}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Flights Value</span>
                <span class="detail-item__value">$${formatNumber(story.details.flights_value)}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Flights Points</span>
                <span class="detail-item__value">${story.details.flights_points}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Hotel Nights</span>
                <span class="detail-item__value">${story.details.hotel_nights}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Hotel Value</span>
                <span class="detail-item__value">$${formatNumber(story.details.hotel_value)}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Hotel Points</span>
                <span class="detail-item__value">${story.details.hotel_points}</span>
              </div>
              <div class="detail-item">
                <span class="detail-item__label">Total Cash Saved</span>
                <span class="detail-item__value--success">$${formatNumber(story.details.total_cash_saved)}</span>
              </div>
            </div>

            <div class="win-card__story">
              "${story.story}"
            </div>

            <div class="win-card__footer">
              <div class="engagement">
                <div class="engagement__item">
                  <i data-lucide="heart" class="icon icon--xs"></i>
                  <span class="engagement__count">${formatNumber(story.engagement.likes)}</span>
                </div>
                <div class="engagement__item">
                  <i data-lucide="message-circle" class="icon icon--xs"></i>
                  <span class="engagement__count">${formatNumber(story.engagement.comments)}</span>
                </div>
              </div>
              <span style="font-size: var(--text-xs); color: var(--color-text-muted);">
                ${formatTime(story.posted_at)}
              </span>
            </div>
          </div>
        </article>
      `;
    }

    function renderHackDiscovery(story) {
      return `
        <article class="win-card">
          <div class="win-card__user">
            <div class="win-card__avatar">${story.user.avatar}</div>
            <div class="win-card__user-info">
              <div class="win-card__username">${story.user.username}</div>
            </div>
            <div class="win-card__type-badge win-card__type-badge--hack_discovery">
              Hack Discovery
            </div>
          </div>

          <div class="win-card__content">
            <h2 class="win-card__title">${story.title}</h2>
            <p class="win-card__summary">${story.summary}</p>

            <div class="win-card__hack">
              <div class="win-card__hack-content">
                ${story.hack}
              </div>
              ${story.warning ? `
                <div class="win-card__warning">
                  <i data-lucide="alert-triangle" class="icon icon--xs"></i>
                  <span>${story.warning}</span>
                </div>
              ` : ''}
            </div>

            <div style="background: var(--color-primary-light); padding: var(--space-4); border-radius: var(--radius-lg); margin-bottom: var(--space-4);">
              <div style="font-size: var(--text-xs); color: var(--color-text-muted); margin-bottom: var(--space-1);">POTENTIAL VALUE</div>
              <div style="font-size: var(--text-lg); font-weight: var(--font-bold); color: var(--color-primary);">${story.value}</div>
            </div>

            <div class="win-card__footer">
              <div class="engagement">
                <div class="engagement__item">
                  <i data-lucide="heart" class="icon icon--xs"></i>
                  <span class="engagement__count">${formatNumber(story.engagement.likes)}</span>
                </div>
                <div class="engagement__item">
                  <i data-lucide="message-circle" class="icon icon--xs"></i>
                  <span class="engagement__count">${formatNumber(story.engagement.comments)}</span>
                </div>
              </div>
              <span style="font-size: var(--text-xs); color: var(--color-text-muted);">
                ${formatTime(story.posted_at)}
              </span>
            </div>
          </div>
        </article>
      `;
    }

    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function formatMemberSince(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
    }

    function formatTime(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);

      if (diff < 60) return 'Just now';
      if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
      if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
      if (diff < 604800) return `${Math.floor(diff / 86400)}d ago`;
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    document.addEventListener('DOMContentLoaded', loadWins);
  </script>
</body>
</html>
