<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Pulse Weekly - MilesAI</title>
  <link rel="stylesheet" href="../css/design-system.css">
  <link rel="stylesheet" href="../css/components.css">
  <style>
  <script>
    lucide.createIcons();
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>
    body { padding: var(--space-8); background: var(--color-bg-canvas); }
    .newsletter-container { max-width: 900px; margin: 0 auto; }

    .newsletter-header {
      background: var(--color-primary);
      color: white;
      padding: var(--space-10) var(--space-6);
      position: relative;
      border-radius: var(--radius-2xl);
      text-align: center;
      margin-bottom: var(--space-8);
      box-shadow: var(--shadow-card);
    }

    .newsletter-header__badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.2);
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-full);
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      margin-bottom: var(--space-3);
      backdrop-filter: blur(10px);
    }

    .newsletter-header__title {
      font-size: var(--text-4xl);
      font-weight: var(--font-bold);
      margin-bottom: var(--space-2);
    }

    .newsletter-header__date {
      font-size: var(--text-lg);
      opacity: 0.9;
      margin-bottom: var(--space-4);
    }

    .newsletter-header__headline {
      font-size: var(--text-xl);
      line-height: var(--leading-relaxed);
      opacity: 0.95;
      max-width: 700px;
      margin: 0 auto;
    }

    .section {
      background: white;
      border-radius: var(--radius-2xl);
      padding: var(--space-6);
      margin-bottom: var(--space-6);
      box-shadow: var(--shadow-card);
    }

    .section__header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-5);
      padding-bottom: var(--space-4);
      border-bottom: 2px solid var(--color-divider);
    }

    .section__icon {
      font-size: var(--text-2xl);
    }

    .section__title {
      font-size: var(--text-2xl);
      font-weight: var(--font-bold);
      color: var(--color-text-primary);
      flex: 1;
    }

    .story-card {
      padding: var(--space-5);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-xl);
      margin-bottom: var(--space-4);
    }

    .story-card:last-child { margin-bottom: 0; }

    .story-card--breaking {
      border-color: var(--color-danger);
      background: var(--color-danger-light);
    }

    .story-card--transfer_bonuses {
      border-color: var(--color-success);
      background: var(--color-primary-light);
    }

    .story-card--card_news {
      border-color: var(--color-info);
      background: var(--color-info-light);
    }

    .story-card__header {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .story-card__icon {
      font-size: var(--text-3xl);
    }

    .story-card__title {
      font-size: var(--text-xl);
      font-weight: var(--font-bold);
      color: var(--color-text-primary);
      flex: 1;
    }

    .story-card__impact-badge {
      padding: var(--space-1) var(--space-3);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: var(--font-bold);
      text-transform: uppercase;
    }

    .story-card__impact-badge--insane {
      background: var(--color-success);
      color: white;
    }

    .story-card__impact-badge--high {
      background: var(--color-warning);
      color: white;
    }

    .story-card__summary {
      font-size: var(--text-base);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
      line-height: var(--leading-relaxed);
    }

    .story-card__details {
      background: white;
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-4);
    }

    .story-card__details ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .story-card__details li {
      padding: var(--space-2) 0;
      padding-left: var(--space-5);
      position: relative;
      color: var(--color-text-secondary);
      font-size: var(--text-sm);
    }

    .story-card__details li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--color-success);
      font-weight: var(--font-bold);
    }

    .story-card__action {
      background: var(--color-accent-light);
      padding: var(--space-3);
      border-radius: var(--radius-lg);
      font-weight: var(--font-semibold);
      color: var(--color-accent-dark);
      font-size: var(--text-sm);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }


    .sweet-spots {
      background: var(--color-primary-light);
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      margin-top: var(--space-3);
    }

    .sweet-spots__title {
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      color: var(--color-primary-dark);
      margin-bottom: var(--space-2);
      text-transform: uppercase;
    }

    .sweet-spots__list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sweet-spots__list li {
      padding: var(--space-2) 0;
      color: var(--color-text-primary);
      font-size: var(--text-sm);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .sweet-spots__list li::before {
      content: '→';
    }

    .trend-item {
      display: flex;
      align-items: flex-start;
      gap: var(--space-4);
      padding: var(--space-4);
      background: var(--color-bg-secondary);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-3);
    }

    .trend-item:last-child { margin-bottom: 0; }

    .trend-item__indicator {
      font-size: var(--text-2xl);
      flex-shrink: 0;
    }

    .trend-item__content { flex: 1; }

    .trend-item__title {
      font-size: var(--text-base);
      font-weight: var(--font-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-1);
    }

    .trend-item__description {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      line-height: var(--leading-relaxed);
    }

    .trend-item__confidence {
      font-size: var(--text-xs);
      color: var(--color-text-muted);
      margin-top: var(--space-1);
    }

    .program-item {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      padding: var(--space-4);
      border-bottom: 1px solid var(--color-divider);
    }

    .program-item:last-child { border-bottom: none; }

    .program-item__name {
      font-weight: var(--font-semibold);
      color: var(--color-text-primary);
      flex: 1;
    }

    .program-item__status {
      padding: var(--space-1) var(--space-3);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: var(--font-semibold);
      text-transform: uppercase;
    }

    .program-item__status--healthy {
      background: var(--color-success-light);
      color: var(--color-success-dark);
    }

    .program-item__status--hot {
      background: var(--color-success);
      color: white;
    }

    .program-item__status--caution {
      background: var(--color-warning-light);
      color: var(--color-warning-dark);
    }

    .program-item__status--declining {
      background: var(--color-danger-light);
      color: var(--color-danger-dark);
    }

    .program-item__rating {
      font-size: var(--text-lg);
      font-weight: var(--font-bold);
      color: var(--color-primary);
      min-width: 50px;
      text-align: center;
    }

    .program-item__note {
      flex: 2;
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--space-4);
    }

    .stat-box {
      background: var(--color-primary-light);
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      text-align: center;
    }

    .stat-box__value {
      font-size: var(--text-4xl);
      font-weight: var(--font-bold);
      color: var(--color-primary);
      margin-bottom: var(--space-2);
    }

    .stat-box__label {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-1);
    }

    .stat-box__change {
      font-size: var(--text-xs);
      color: var(--color-text-muted);
    }

    .lookahead-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .lookahead-list li {
      padding: var(--space-3);
      padding-left: var(--space-6);
      position: relative;
      color: var(--color-text-secondary);
      font-size: var(--text-base);
      border-bottom: 1px solid var(--color-divider);
    }

    .lookahead-list li:last-child { border-bottom: none; }

    .lookahead-list li::before {
      content: '→';
      position: absolute;
      left: var(--space-3);
      top: var(--space-3);
    }

    .community-grid {
      display: grid;
      gap: var(--space-4);
    }

    .community-highlight {
      background: var(--color-bg-secondary);
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    .community-highlight__user {
      font-weight: var(--font-semibold);
      color: var(--color-primary);
      min-width: 150px;
    }

    .community-highlight__achievement {
      flex: 1;
      color: var(--color-text-secondary);
      font-size: var(--text-sm);
    }

    .community-highlight__engagement {
      color: var(--color-text-muted);
      font-size: var(--text-sm);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .program-item { flex-wrap: wrap; }
      .program-item__note { flex: 100%; margin-top: var(--space-2); }
      .community-highlight { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="newsletter-container">
    <header class="newsletter-header" id="newsletter-header">
      <!-- Loaded dynamically -->
    </header>

    <div id="content">
      <!-- Loaded dynamically -->
    </div>
  </div>

  <script>
    async function loadNewsletter() {
      try {
        const response = await fetch('../data/market-pulse.json');
        const data = await response.json();
        renderNewsletter(data);
      } catch (error) {
        console.error('Error loading newsletter:', error);
      }
    }

    function renderNewsletter(data) {
      renderHeader(data.current_week);
      renderContent(data);
    }

    function renderHeader(week) {
      const header = document.getElementById('newsletter-header');
      header.innerHTML = `
        <div class="newsletter-header__badge">Week ${week.week_number} • ${week.year}</div>
        <h1 class="newsletter-header__title"><i data-lucide="trending-up" class="icon icon--lg"></i><span>Market Pulse Weekly</span></h1>
        <div class="newsletter-header__date">${week.date_range}</div>
        <p class="newsletter-header__headline">${week.summary}</p>
      `;
      lucide.createIcons();
    }

    function renderContent(data) {
      const content = document.getElementById('content');
      content.innerHTML = `
        ${renderTopStories(data.top_stories)}
        ${renderWeekInNumbers(data.week_in_numbers)}
        ${renderMarketTrends(data.market_trends)}
        ${renderProgramWatch(data.program_watch)}
        ${renderLookingAhead(data.looking_ahead)}
        ${renderCommunityHighlights(data.community_highlights)}
      `;
      lucide.createIcons();
    }

    function renderTopStories(stories) {
      return `
        <section class="section">
          <div class="section__header">
            <i data-lucide="newspaper" class="icon icon--md section__icon"></i>
            <h2 class="section__title">Top Stories</h2>
          </div>
          ${stories.map(story => `
            <div class="story-card story-card--${story.category}">
              <div class="story-card__header">
                <span class="story-card__icon">${story.icon}</span>
                <h3 class="story-card__title">${story.title}</h3>
                <span class="story-card__impact-badge story-card__impact-badge--${story.impact.toLowerCase()}">
                  ${story.impact}
                </span>
              </div>
              <p class="story-card__summary">${story.summary}</p>
              <div class="story-card__details">
                <ul>
                  ${story.details.map(detail => `<li>${detail}</li>`).join('')}
                </ul>
              </div>
              ${story.sweet_spots ? `
                <div class="sweet-spots">
                  <div class="sweet-spots__title">Sweet Spots</div>
                  <ul class="sweet-spots__list">
                    ${story.sweet_spots.map(spot => `<li>${spot}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}
              <div class="story-card__action">${story.action}</div>
            </div>
          `).join('')}
        </section>
      `;
    }

    function renderWeekInNumbers(stats) {
      return `
        <section class="section">
          <div class="section__header">
            <i data-lucide="bar-chart" class="icon icon--md section__icon"></i>
            <h2 class="section__title">Week in Numbers</h2>
          </div>
          <div class="stats-grid">
            ${stats.map(stat => `
              <div class="stat-box">
                <div class="stat-box__value">${stat.stat}</div>
                <div class="stat-box__label">${stat.label}</div>
                <div class="stat-box__change">${stat.change}</div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderMarketTrends(trendsData) {
      return `
        <section class="section">
          <div class="section__header">
            <i data-lucide="trending-up" class="icon icon--md section__icon"></i>
            <h2 class="section__title">${trendsData.title}</h2>
          </div>
          ${trendsData.trends.map(trend => `
            <div class="trend-item">
              <i data-lucide="${trend.direction === 'up' ? 'trending-up' : 'trending-down'}" class="icon icon--md trend-item__indicator"></i>
              <div class="trend-item__content">
                <div class="trend-item__title">${trend.trend}</div>
                <div class="trend-item__description">${trend.description}</div>
                <div class="trend-item__confidence">Confidence: ${trend.confidence}</div>
              </div>
            </div>
          `).join('')}
        </section>
      `;
    }

    function renderProgramWatch(programData) {
      return `
        <section class="section">
          <div class="section__header">
            <i data-lucide="trophy" class="icon icon--md section__icon"></i>
            <h2 class="section__title">${programData.title}</h2>
          </div>
          ${programData.programs.map(program => `
            <div class="program-item">
              <div class="program-item__name">${program.name}</div>
              <span class="program-item__status program-item__status--${program.status}">
                ${program.status}
              </span>
              <div class="program-item__rating">${program.rating}</div>
              <div class="program-item__note">${program.note}</div>
            </div>
          `).join('')}
        </section>
      `;
    }

    function renderLookingAhead(lookingAhead) {
      return `
        <section class="section">
          <div class="section__header">
            <i data-lucide="eye" class="icon icon--md section__icon"></i>
            <h2 class="section__title">${lookingAhead.title}</h2>
          </div>
          <ul class="lookahead-list">
            ${lookingAhead.items.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </section>
      `;
    }

    function renderCommunityHighlights(highlights) {
      return `
        <section class="section">
          <div class="section__header">
            <i data-lucide="star" class="icon icon--md section__icon"></i>
            <h2 class="section__title">Community Highlights</h2>
          </div>
          <div class="community-grid">
            ${highlights.map(highlight => `
              <div class="community-highlight">
                <div class="community-highlight__user">@${highlight.username}</div>
                <div class="community-highlight__achievement">${highlight.achievement}</div>
                <div class="community-highlight__engagement">
                  <i data-lucide="heart" class="icon icon--xs"></i> ${formatNumber(highlight.engagement)}
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
    }

    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    document.addEventListener('DOMContentLoaded', loadNewsletter);
  <script>
    lucide.createIcons();
  </script>
  </script>
</body>
</html>
